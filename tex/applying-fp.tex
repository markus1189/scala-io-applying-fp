\documentclass{beamer}

\usepackage{minted}
\usepackage{pgf}
\usepackage[utf8]{inputenc}
\usepackage{mdframed}
\usepackage{animate}
\usepackage{media9}
\usepackage{graphicx}

\BeforeBeginEnvironment{minted}{\begin{mdframed}}
\AfterEndEnvironment{minted}{\end{mdframed}}

\title{Applying FP Patterns}
\subtitle{Or: Why should I care about FP}
\author{Markus Hauck}
\date{Scala.IO, 2016}
\subject{Computer Science}

\input{./beamer-setup}

\begin{document}
\frame{\titlepage}

\section{Intro}
\label{sec:intro}

\begin{frame}
  \frametitle{Introduction}
  \begin{itemize}
  \item FP has become very popular
  \item Even without complete commitment, useful patterns
  \item Today we will have a look at some of them
  \end{itemize}
\end{frame}
\begin{frame}
  \frametitle{The second slide}
  \framesubtitle{subtitle on second slide}
\end{frame}

\section{Monoids}
\label{sec:monoids}

\begin{frame}
  \frametitle{Lego vs Duplo}
  FP = Lego, OO = Duplo?
\end{frame}

\begin{frame}
  \frametitle{Monoids}
  \begin{itemize}
  \item intuition: ``summon \& combine stuff''
  \item you can create values from thin air
  \item combine two values into one
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{I thought this was about ``applying''}
  \begin{itemize}
  \item damn right, so let's do that!
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Apache Spark}
  \begin{itemize}
  \item Apache Spark:
    \begin{itemize}
    \item analysis of a text (huuuuge)
    \item run in cluster
    \end{itemize}
  \item some possible metrics over text
    \begin{itemize}
    \item word count
    \item char count
    \item min/max word length
    \item avg word length
    \item \dots (be flexible)
    \end{itemize}
  \item \textbf{goal}: single traversal $\leftrightarrow$ easy composition
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Using Monoids}
  \begin{itemize}
  \item monoids are perfect for this
  \item all we need from Spark is the \texttt{fold} function on \texttt{RDD}s
  \end{itemize}
\begin{minted}{scala}
foo bar baz
\end{minted}
\end{frame}

% IDEA: use the `animate' package to show animations

\begin{frame}
  \frametitle{More Monoid Tricks}
  \begin{itemize}
  \item ``filter'' values via \texttt{mempty} value
  \item map + reduce == two phase computation via monoids
  \item finger trees, implement multiple data structures using monoids
  \item drawing diagrams (haskell)
  \end{itemize}
\end{frame}

\section{Exceptions \& Errors}
\label{sec:exceptions-and-errors}

\begin{frame}[c]
  \begin{center}
    Part 2: Dealing with Exceptions and Errors
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{The Traditional Way}
  \begin{itemize}
  \item Java style: \texttt{try}/\texttt{catch}/\texttt{finally}
  \item \textit{checked} exceptions
    \begin{itemize}
    \item compiler help
    \item reduce return value checking
    \end{itemize}
  \item \textit{unchecked} exceptions
    \begin{itemize}
    \item only visible via docs, if documented at all
    \item currently the only way to go in Java
    \end{itemize}
  \item errors? return \texttt{null} / custom classes
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{The Functional Way}
  \begin{itemize}
  \item Scala: only \textit{unchecked} exceptions
  \item but: \texttt{throw} and \texttt{catch} discouraged in FP anyway
  \item FP:\@ type system + first class values
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Out Of The Box}
  \begin{itemize}
  \item \texttt{Either} / \texttt{Try}
    \begin{itemize}
    \item \texttt{Either} unbiased (before 2.12)
    \item \texttt{Try} not a lawful monad\dots
    \end{itemize}
  \item get the most bang for your buck: use a FP library
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Try and Catch}
\begin{minted}{scala}
def convert(is: String*): List[Int] =
  is.map(_.toInt).toList
\end{minted}

\begin{minted}{scala}
convert("1","2","3","Hello World!","5")
\end{minted}
\begin{minted}[fontsize=\tiny]{text}
java.lang.NumberFormatException: For input string: "Hello World"
  at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
  at java.lang.Integer.parseInt(Integer.java:580)
  at java.lang.Integer.parseInt(Integer.java:615)
  ...
\end{minted}
\end{frame}

\begin{frame}
  \frametitle{Try and Catch: Not Compositonal}
  \begin{itemize}
  \item problem is that \texttt{try}/\texttt{catch} does not compose
    nicely (Duplo)
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Example Time}
  \begin{itemize}
  \item password validation
  \item constraints:
    \begin{itemize}
    \item length $\geq$ 10
    \item contains at least one number
    \item contains at least one special char
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Representing Errors (Java)}
\end{frame}

\begin{frame}
  \frametitle{Validation}
  \begin{itemize}
  \item example: password input
  \item fail 1: too short
  \item fail 2: no numbers
  \item fail 3: no special chars
  \item raaaaage because of sequential errors
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Validation}
  \begin{itemize}
  \item scenario: multiple unrelated error conditions, result is
    fail/success
  \item \texttt{Either,Xor,etc.} are made for fail-fast, or
    short circuiting
  \item solution: \texttt{Validation/Validated}
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Passwords with Validation}
  \begin{itemize}
  \item goal: present \textbf{all} errors at once
  \end{itemize}
\begin{minted}{scala}
// example with validation
\end{minted}
\end{frame}

\begin{frame}
  \frametitle{Ior (cats) and \textbackslash{}\&/ (scalaz)}
  \begin{itemize}
  \item what about ``non-fatal'' exceptions
  \item instead of short circuiting, continue with warning
  \item there might still be fatal situations with short circuiting
  \item solution: \mintinline{scala}{Ior} and \mintinline{scala}{\&/}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Using Ior}
  \begin{itemize}
  \item \texttt{Validation} was for multiple independent errors
  \item \texttt{Ior}: instead of fail/succeed $\rightarrow$ fail/succeed/succeed with warnings
  \end{itemize}
\end{frame}

\end{document}
